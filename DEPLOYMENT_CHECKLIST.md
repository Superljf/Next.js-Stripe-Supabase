# 部署前检查清单

在部署项目之前，请确保完成以下所有步骤。

## 1. 代码准备

### 1.1 代码状态检查
- [ ] 确保所有代码更改已提交到 Git
- [ ] 确保本地代码与远程仓库同步
- [ ] 运行测试确保没有错误
```bash
pnpm test
```

### 1.2 构建检查
- [ ] 确保项目可以成功构建
```bash
pnpm build
```

## 2. 环境变量配置

### 2.1 必需环境变量
确保以下环境变量已正确设置：

- [ ] `NEXT_PUBLIC_SUPABASE_URL` - Supabase 项目 URL
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Supabase 匿名密钥
- [ ] `SUPABASE_SERVICE_ROLE_KEY` - Supabase 服务角色密钥
- [ ] `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` - Stripe 发布密钥
- [ ] `STRIPE_SECRET_KEY` - Stripe 密钥
- [ ] `STRIPE_WEBHOOK_SECRET` - Stripe Webhook 密钥
- [ ] `NEXT_PUBLIC_SITE_URL` - 站点 URL

### 2.2 环境变量文件
- [ ] 确保 [.env.production](file:///d:/2025%E4%B8%8B%E5%8D%8A%E5%B9%B4Code/Next.js-Stripe-Supabase/.env.production) 文件已创建（如果需要）
- [ ] 确保敏感信息不会被提交到 Git 仓库

## 3. Supabase 配置

### 3.1 数据库设置
- [ ] Supabase 项目已创建
- [ ] 数据库表已创建（通过 [schema.sql](file:///d:/2025%E4%B8%8B%E5%8D%8A%E5%B9%B4Code/Next.js-Stripe-Supabase/schema.sql) 或迁移）
- [ ] 行级安全策略已配置
- [ ] 认证设置已完成

### 3.2 认证配置
- [ ] OAuth 提供商已配置（如 GitHub）
- [ ] 重定向 URL 已设置
- [ ] 注册/登录功能已测试

## 4. Stripe 配置

### 4.1 Stripe 账户
- [ ] Stripe 账户已创建
- [ ] 产品和价格已设置
- [ ] Webhook 端点已创建
- [ ] 客户门户已配置

### 4.2 Webhook 设置
- [ ] Webhook URL: `https://your-domain.com/api/webhooks`
- [ ] 已选择所有必要事件
- [ ] Webhook 签名密钥已获取

## 5. 域名和 SSL

### 5.1 域名配置
- [ ] 自定义域名已购买
- [ ] DNS 记录已配置
- [ ] 域名已在部署平台添加

### 5.2 SSL 证书
- [ ] SSL 证书已配置（Vercel/Netlify 通常自动处理）

## 6. 部署平台配置

### 6.1 Vercel 配置（如果使用 Vercel）
- [ ] Vercel 账户已创建
- [ ] Git 仓库已连接
- [ ] 环境变量已添加
- [ ] 构建设置已确认

### 6.2 其他平台配置
- [ ] 根据选择的平台完成相应配置

## 7. 性能优化

### 7.1 图片优化
- [ ] 使用 `next/image` 组件处理图片
- [ ] 图片已优化大小和格式

### 7.2 静态资源
- [ ] 静态资源放在 [public](file:///d:/2025%E4%B8%8B%E5%8D%8A%E5%B9%B4Code/Next.js-Stripe-Supabase/public) 目录中
- [ ] 资源文件已压缩

## 8. 安全检查

### 8.1 代码安全
- [ ] 没有硬编码的敏感信息
- [ ] 服务角色密钥不会暴露给客户端
- [ ] 输入验证已实现

### 8.2 网络安全
- [ ] HTTPS 已强制启用
- [ ] 内容安全策略已配置
- [ ] 安全头已设置

## 9. 监控和日志

### 9.1 错误监控
- [ ] 错误监控服务已集成（如 Sentry）
- [ ] 关键功能有适当的日志记录

### 9.2 性能监控
- [ ] 性能监控已设置
- [ ] 关键指标已定义

## 10. 备份策略

### 10.1 代码备份
- [ ] 代码已推送到远程仓库
- [ ] 重要分支已保护

### 10.2 数据备份
- [ ] 数据库备份策略已制定
- [ ] 备份已测试恢复

## 11. 测试清单

### 11.1 功能测试
- [ ] 用户注册/登录功能正常
- [ ] 支付流程正常
- [ ] 订阅管理正常
- [ ] 客户门户可访问

### 11.2 性能测试
- [ ] 页面加载时间可接受
- [ ] 移动端适配正常
- [ ] 不同浏览器兼容性测试

### 11.3 安全测试
- [ ] XSS 攻击防护有效
- [ ] CSRF 保护已实现
- [ ] 敏感信息未泄露

## 12. 部署后验证

### 12.1 功能验证
- [ ] 站点可正常访问
- [ ] 所有页面加载正常
- [ ] 用户注册/登录正常
- [ ] 支付流程正常

### 12.2 监控验证
- [ ] 错误监控正常工作
- [ ] 性能监控正常工作
- [ ] 日志记录正常

完成以上所有检查项后，项目就可以安全地部署到生产环境了。